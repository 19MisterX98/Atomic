package me.zeroX150.atomic.feature.module.impl.exploit;

import me.zeroX150.atomic.Atomic;
import me.zeroX150.atomic.feature.module.Module;
import me.zeroX150.atomic.feature.module.ModuleType;
import me.zeroX150.atomic.feature.module.config.MultiValue;
import net.minecraft.block.BlockState;
import net.minecraft.block.Blocks;
import net.minecraft.client.Keyboard;
import net.minecraft.client.util.math.MatrixStack;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Box;
import net.minecraft.util.math.Vec3d;
import net.minecraft.util.math.Vec3i;

public class Phase extends Module {

    public MultiValue mode;

    public int delay = 0;

    public Phase() {
        super("Phase", "go through walls like a ghost", ModuleType.EXPLOIT);
        mode = this.config.create("Mode", "Vanilla", "Vanilla", "Ground");
        mode.description("The phase mode");
    }

    @Override
    public void tick() {
        assert Atomic.client.player != null;
        assert Atomic.client.world != null;
        if (mode.getValue().equals("Ground") && delay == 0) {
            if (Atomic.client.options.keySneak.isPressed() && Atomic.client.player.verticalCollision) {
                for (int i = Atomic.client.player.getBlockY() - 1; i > 0; i--) {
                    if (Atomic.client.world.getBlockState(Atomic.client.player.getBlockPos().subtract(new Vec3i(0, Atomic.client.player.getBlockY() - i, 0))).getBlock() == Blocks.AIR && Atomic.client.world.getBlockState(Atomic.client.player.getBlockPos().subtract(new Vec3i(0, Atomic.client.player.getBlockY() - i - 1, 0))).getBlock() == Blocks.AIR) {
                        Atomic.client.player.updatePosition(Atomic.client.player.getX(), i, Atomic.client.player.getZ());
                        break;
                    }
                }
                delay = 20;
            }
        }
        if (Atomic.client.player.horizontalCollision && Atomic.client.options.keySneak.isPressed()) {
            Vec3i vec3i = Atomic.client.player.getHorizontalFacing().getVector();
            //Box box = Atomic.client.player.getBoundingBox();
            Atomic.client.player.setBoundingBox(new Box(0,0,0,0,0,0));
            Atomic.client.player.updatePosition(Atomic.client.player.getX() + vec3i.getX() * 2, Atomic.client.player.getY(), Atomic.client.player.getZ() + vec3i.getZ() * 2);
            Atomic.client.getNetworkHandler().sendPacket(new PlayerMoveC2SPacket.PositionAndOnGround(Atomic.client.player.getX(), Atomic.client.player.getY(), Atomic.client.player.getZ(), false));
            //Atomic.client.getNetworkHandler().sendPacket(new PlayerMoveC2SPacket.PositionAndOnGround(Atomic.client.player.getX() - 307, Atomic.client.player.getY(), Atomic.client.player.getZ() - 307, false));
            //Atomic.client.getNetworkHandler().sendPacket(new PlayerMoveC2SPacket.PositionAndOnGround(Atomic.client.player.getX(), Atomic.client.player.getY(), Atomic.client.player.getZ(), false));
            //Atomic.client.player.setBoundingBox(box.offset(new Vec3d(vec3i.getX(), vec3i.getY(), vec3i.getZ())));
        }
        if (delay > 0) {
            delay--;
        }
    }

    @Override
    public void enable() {

    }

    @Override
    public void disable() {

    }

    @Override
    public String getContext() {
        return this.mode.getValue();
    }

    @Override
    public void onWorldRender(MatrixStack matrices) {

    }

    @Override
    public void onHudRender() {

    }
}
